# LabelTrack 项目说明

这是一个基于PyQt5开发的标注工具，开发部分需要参考[官方文档](https://doc.qt.io/qtforpython-5/modules.html)

# 安装说明

参照README.md文件中情况进行安装时容易遇到的问题:

```
cl: 命令行 error D8021 :无效的数值参数“/Wno-cpp”
```

这是由于pycocotools安装时与windows系统中编译兼容的问题导致的，可选的解决方案有两种：

- 选择源码安装出现问题的包，修改setup.py中编译器的设定：
  - extra_compile_args=["-Wno-cpp", "Won-unused-function", "-std=c99"]
  - extra_compile_args=["-std=c99"]
- 选择从其他源下载安装：
  - pip install git+https://github.com/philferriere/cocoapi.git#subdirectory=PythonAPI


## 使用说明

软件在使用模型加载内容时修改 /Tracking/configs/下对应模型的配置文件， 修改其中的模型文件地址才能正常使用

## 代码结构说明

需要关注以下两部分内容
```
./GUI
./Tracking
```

### ./GUI

这部分是实现整个标注软件交互界面的代码，具体情况如下：

- ui_window.ui

是软件ui的设计，安装pyqt5之后可以通过designer进行手工交互式的调整

- main.py
  
是软件UI主体部分的代码，写明了软件窗口中不同按键的主要功能，需要注意的是，在./GUI下的main.py文件直接运行会有文件路径的错误，运行软件需要执行在项目主目录下的main.py


- canvas.py  **核心对象**

是图片标记实现的主要操作对象，包括鼠标在画布上移动、点击对应的事件、修改边框、修改标记、画出标记框等

- trackworker.py
  
实现目标跟踪的线程代码，检测模型与目标跟踪的代码在./Tracking下，调用./Tracking/demo/下不同跟踪器的Predictor类和frames_track进行跟踪，目前只有bytetrack被引用

- load_worker.py

加载标注文件的线程


- fileworker.py

加载图片的线程代码

- shape.py

图形对象，用于提供标注框等图形的增减、绘制

- tools.py

内部只有一个转换函数，将opencv读取的函数转换成为pyqt5的格式

- label_dialog.py

进行标记时弹出的对话框，包括了修改id，修改类别

- label_combox.py

设定默认标记相关信息的代码，为左侧工具栏中默认类别的选择框

- zoomWidget.py

设置缩放比例调整事件的代码

- model_dialog.py

模型选择代码，这里只能选择类别，然后tracker等类别通过canvas获得到类别信息之后加载对应的配置文件以及其中指定的模型

- utils.py

一些工具性代码，例如按字母数组排序、从文件夹中拿到所有文件名，字符串相关操作等

- color.py

一些定义变量，一般不做修改，包括不同类别检测框的颜色

- test.py
  
应该是作者之前用于测试一些鼠标事件的代码，后续可以用于测试

- frame.py constants.py

并未发现引用的代码，frame.py应该是早期用于简单跟踪的代码，已经废弃但未删除，内容与trakworker有部分重叠,  constants.py现在未发现用途


### ./Tracking

这部分代码中应该有大量的代码是从已有的目标跟踪项目中复制的，与软件相关的代码有以下部分:

- ./Tracking/demo

是与trackworker直接对接的代码，现在仅bytetrack.py可用

- ./Tracking/yolox

模型文件，跟踪算法相关代码

- ./Tracking/config
  
配置文件，提供一些模型配置的代码


## 后续可能改动

### 模型选择

目前模型只能选择类别，模型文件加载都是通过内置代码和配置文件实现，可以改成选择模型类别与模型文件的方式，以用户交互的形式减少代码修改

### 标注时拖拽图片功能的实现

目前在标注时只能通过滑动滚轮实现位置的改变，希望增加可以拖拽图片的功能

### 标注格式的修改

现在只有固定的visdrone格式检测框，可以提供选择不同格式检测框进行输出

### 修改标注的组织形式

现在标注的形式是以canvas对象中的shapes保存，每个shapes之间是独立的，如果需要修改会比较困难，可以考虑修改标注框的数据组织形式，以id为索引的map，这样可以更好的实现轨迹的合并与修改

### 其他检测、跟踪方法的实现

现在能够正常运行的只有bytetrack一种跟踪检测方法，因为检测线程中是将canvas类中的所有图片和检测框输送到predictor类和对应的检测代码中进行修改，因此可以单独对/Tracking进行调整